# 6. 문제 해결 (Troubleshooting)

이 문서는 Monogo 프로젝트를 운영하면서 발생할 수 있는 일반적인 문제와 해결 방법을 안내합니다.

## 6.1. 백엔드 서비스 기동 실패: `Error: Cannot find module 'dotenv'`

### 문제 현상
`docker compose up -d --build` 명령으로 서비스를 기동했을 때, `monogo-backend` 서비스 로그에서 `Error: Cannot find module 'dotenv'` 오류가 발생하며 백엔드가 정상적으로 시작되지 않습니다.

### 원인
`backend/package.json` 파일에 `dotenv` 모듈이 종속성으로 명시되어 있지 않아 Docker 이미지 빌드 시 설치되지 않았기 때문입니다.

### 해결 방법
1. `backend/package.json` 파일을 열어 `dependencies` 섹션에 `"dotenv": "^16.4.5"`를 추가합니다.
   ```json
   {
     "name": "monogo-backend",
     "version": "1.0.0",
     "main": "app.js",
     "license": "MIT",
     "dependencies": {
       "cors": "^2.8.5",
       "dotenv": "^16.4.5", // 이 라인을 추가
       "express": "^4.21.2"
     },
     "description": "",
     "scripts": {
       "test": "echo \"Error: no test specified\" && exit 1"
     },
     "keywords": [],
     "author": "",
     "type": "commonjs"
   }
   ```
2. 변경 사항을 적용하기 위해 `monogo-backend` 서비스를 다시 빌드하고 기동합니다.
   ```bash
   docker compose up -d --build monogo-backend
   ```
3. 서비스 로그를 확인하여 정상적으로 기동되었는지 확인합니다.
   ```bash
   docker compose logs monogo-backend
   ```
   정상적으로 기동되면 `Server running on port 4000` 메시지가 출력됩니다.

## 6.2. 웹 페이지 접속 시 500 에러 (`rewrite or internal redirection cycle`)

### 문제 현상
웹 브라우저에서 `http://localhost`로 접속 시 500 Internal Server Error가 발생하며, `monogo-nginx` 로그에 `rewrite or internal redirection cycle while internally redirecting to "/index.html"`과 같은 오류 메시지가 나타납니다.

### 원인
`nginx/nginx.conf` 파일의 `location /` 블록에 `try_files $uri $uri/ /index.html;` 설정이 React 애플리케이션의 라우팅과 충돌하여 무한 리디렉션 루프를 발생시켰기 때문입니다. React 애플리케이션은 자체적으로 클라이언트 측 라우팅을 처리하므로, Nginx에서 `index.html`로의 내부 리디렉션이 필요하지 않습니다.

### 해결 방법
1. `nginx/nginx.conf` 파일을 열어 `location /` 블록을 다음과 같이 수정합니다.
   ```nginx
   location / {
     proxy_pass http://monogo-frontend:80;
     # try_files $uri $uri/ /index.html; # 이 라인을 제거하거나 주석 처리
   }
   ```
2. 변경 사항을 적용하기 위해 `monogo-nginx` 서비스를 재시작합니다.
   ```bash
   docker compose restart monogo-nginx
   ```
3. 웹 브라우저에서 다시 접속하여 500 에러가 해결되었는지 확인합니다.

## 6.3. "저장된 게임 목록 불러오기 실패: Request failed with status code 404" 메시지 박스

### 문제 현상
웹 페이지 접속 시 "저장된 게임 목록 불러오기 실패: Request failed with status code 404"라는 메시지 박스가 즉시 표시됩니다. `monogo-nginx` 로그에는 `GET /api/list HTTP/1.1" 404` 오류가 기록됩니다.

### 원인
프론트엔드(`monogo-frontend`)는 백엔드 API를 `/api/list`와 같은 경로로 호출합니다. Nginx 설정(`nginx/nginx.conf`)의 `location /api` 블록에서 `proxy_pass http://monogo-backend:4000;`와 같이 슬래시(`/`)가 없는 형태로 설정되어 있으면, Nginx는 `/api` 접두사를 포함한 전체 요청 경로(`http://monogo-backend:4000/api/list`)를 백엔드로 전달합니다.

하지만 백엔드(`backend/app.js`)는 `/list` 경로에 대한 핸들러만 가지고 있으며, `/api/list` 경로는 알지 못하므로 404 에러를 반환합니다.

### 해결 방법
1. `nginx/nginx.conf` 파일을 열어 `location /api` 블록의 `proxy_pass` 지시어를 다음과 같이 수정합니다.
   ```nginx
   location /api {
     proxy_pass http://monogo-backend:4000/; # 슬래시(/)를 추가
     proxy_set_header Host $host;
     proxy_set_header X-Real-IP $remote_addr;
     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
     proxy_set_header X-Forwarded-Proto $scheme;
   }
   ```
   `proxy_pass` 뒤에 슬래시(`/`)를 추가하면 Nginx는 `location`에 매칭된 `/api` 부분을 제거하고 나머지 경로만 백엔드로 전달합니다. (예: `/api/list` -> `http://monogo-backend:4000/list`)
2. 변경 사항을 적용하기 위해 `monogo-nginx` 서비스를 재시작합니다.
   ```bash
   docker compose restart monogo-nginx
   ```
3. 웹 브라우저에서 다시 접속하여 메시지 박스가 더 이상 뜨지 않고 정상적으로 작동하는지 확인합니다.
